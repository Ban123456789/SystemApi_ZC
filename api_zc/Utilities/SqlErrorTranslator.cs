using Microsoft.Data.SqlClient;

namespace Accura_MES.Utilities
{
    public static class SqlErrorTranslator
    {
        // 錯誤碼與友好訊息的對應表
        private static readonly Dictionary<int, string> SqlErrorMessages = new Dictionary<int, string>
        {
            { 53, "無法找到 SQL Server（網路問題、主機名錯誤）" },
            { 134, "欄位已經宣告，請檢查哪兩筆資料的欄位的值重複。" },
            { 544, "欄位不允許插入。" },
            { 547, "資料衝突，操作違反外鍵或檢查約束。" },
            { 2627, "違反唯一約束，請確認資料唯一性。" },
            { 2601, "資料已存在，不能重複插入。" },
            { 4060, "無法連接到指定的資料庫，請檢查資料庫配置。" },
            { 18456, "身份驗證失敗，請檢查用戶名和密碼。" },
            { 1205, "操作發生死鎖，請稍後重試。" },
            { 1105, "伺服器資源不足，請聯繫系統管理員。" },
            { 229, "您無權執行該操作，請聯繫管理員。" },
            { 8115, "數值超出範圍，請檢查輸入的數據。" },
            { 245, "輸入的數據類型與資料庫不一致，請檢查輸入的數據。" },
            { 102, "語法錯誤: 請檢查 SQL 語句的語法是否正確。" },
            { 207, "無效的列名稱: 請確認列名是否拼寫正確，且該列是否存在。" },
            { 208, "無效的物件名稱: 請確認表名或視圖名稱是否拼寫正確，且該物件是否存在。" },
            { 213, "插入列名或值數量不匹配: 請檢查插入語句中提供的列名和值是否與表結構一致。" },
            { 4104, "無法解析多部分標識符: 請檢查表或列的別名是否正確使用。" },
            { 512, "子查詢返回多行: 請確認子查詢是否應返回單一值。" },
            { 105, "引號未閉合: 請檢查語句中是否缺少引號閉合。" },
            { 156, "語法錯誤: 關鍵字使用不正確，請檢查 SQL 語句。" },
            { 2714, "物件已存在: 該表、視圖或索引已存在，無法重複創建。" },
            { 2812, "找不到存儲過程: 請確認存儲過程名稱是否正確，且該存儲過程是否存在。" },
            { 5123, "創建文件錯誤: 請確認數據庫文件的路徑或權限是否正確。" },
            { 8114, "數據類型轉換錯誤: 請確認數據類型是否正確並相容。" },
            { 8152, "字符串或二進制數據超出長度: 請檢查插入的數據是否超過欄位定義的大小。" },
            { 10709, "每個資料列的資料行數目必須相同: 請檢查輸入的數據是否欄位數量一致。" },
            { 13609, "欄位的 JSON 字串格式可能不正確 ; 或 SQL 查詢鍵名必須使用正確的 JSON 路徑。" },
            { 50000, "系統錯誤，請聯繫系統管理員。" }
        };

        /// <summary>
        /// 將 SqlException 的錯誤碼轉換為友好訊息
        /// </summary>
        /// <param name="exception">捕獲的 SqlException</param>
        /// <returns>友好訊息</returns>
        public static string Translate(SqlException exception)
        {
            if (SqlErrorMessages.ContainsKey(exception.Number))
            {
                return SqlErrorMessages[exception.Number] + $"(錯誤碼: {exception.Number})，錯誤訊息：{exception.Message}";
            }

            // 如果未找到對應訊息，返回默認值
            return $"發生未知的資料庫錯誤 (錯誤碼: {exception.Number})，錯誤訊息：{exception.Message}";
        }
    }


}
